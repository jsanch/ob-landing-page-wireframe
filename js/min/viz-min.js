function ColoradoMap(t){this.divId=t,this.divSelector="#"+t,this.initMap=function(){var t=this,e=document.getElementById(t.divId);t.height=e.clientHeight,t.width=800/1200*t.height,console.log("Making map size: "+t.width+"x"+t.height),t.projection=d3.geo.conicConformal(),t.path=d3.geo.path().projection(t.projection),t.svg=d3.select(t.divSelector).append("svg").attr("width",t.width).attr("height",t.height),t.layer1=t.svg.append("g"),t.layer2=t.svg.append("g"),t.getRSA().then(function(){t.getDistricts().then(function(){t.getBOCESPoints().then(function(){t.centerMapProjection(),t.drawBOCES(),t.animateBOCES()})})}),$("#all").click(function(){t.clear(),t.drawALL()}),$("#BOCES").click(function(){t.clear(),t.drawBOCES(),t.animateBOCES()}),$("#districts").click(function(){t.clear(),t.drawDistricts(),t.animateDistricts()})},this.clear=function(){this.layer1.html(""),this.layer2.html("")},this.drawALL=function(){var t=this;t.centerMapProjection(),t.drawDistricts(),t.animateDistricts(),setTimeout(function(){t.drawBOCES(),t.animateBOCES()},3e3)},this.getRSA=function(){var t=$.Deferred(),e=this;return d3.json("mapdata/BOCES.json",function(a,i){e.RSA=i,t.resolve()}),t.promise()},this.getBOCESPoints=function(){var t=$.Deferred(),e=this;return d3.json("mapdata/CoBOCES_goecoded.geojson",function(a,i){e.BOCESPoints=i,t.resolve()}),t.promise()},this.drawBOCES=function(){var t=this,e=t.layer2.selectAll("path").data(t.RSA.features).enter().append("path").attr("id",function(t,e){return"BOCES_"+t.properties.OBJECTID}).attr("class","RSA").attr({stroke:"#999","stroke-width":3,d:t.path}),a=t.layer2.selectAll("circle").data(t.BOCESPoints.features).enter().append("circle").attr("cx",function(e){return-5+t.projection([e.properties.LONGITUDE,e.properties.LATITUDE])[0]}).attr("cy",function(e){return-8+t.projection([e.properties.LONGITUDE,e.properties.LATITUDE])[1]}).attr("r","10px").attr("class","BOCES").on("mouseover",function(t){$("#name").text("BOCES: "+t.properties.Name)}).on("click",t.BOCES_OnClick),i=t.layer2.selectAll("text").data(t.BOCESPoints.features).enter().append("text").attr("x",function(e){return t.projection([e.properties.LONGITUDE,e.properties.LATITUDE])[0]}).attr("y",function(e){return t.projection([e.properties.LONGITUDE,e.properties.LATITUDE])[1]}).text(function(t){return t.properties.Name}).attr("class","BOCES-name");t.arrangeLabels()},this.animateBOCES=function(){map.layer2.selectAll("path").each(function(t,e){map.animate("#BOCES_"+t.properties.OBJECTID)})},this.getDistricts=function(){var t=$.Deferred(),e=this;return d3.json("mapdata/CoSchoolDistricts.json",function(a,i){e.Districts=i,t.resolve()}),t.promise()},this.drawDistricts=function(){var t=this;t.layer1.selectAll("path").data(t.Districts.features).enter().append("path").attr("id",function(t,e){return"district_"+t.properties.OBJECTID}).attr("class","district").attr({stroke:"#999","stroke-width":1,d:t.path}).on("mouseover",function(t){$("#name").text("School District: "+t.properties.NAME)}).on("click",t.BOCES_OnClick)},this.animateDistricts=function(){map.layer1.selectAll("path").each(function(t,e){map.animate("#district_"+t.properties.OBJECTID)})},this.centerMapProjection=function(){var t=d3.geo.centroid(map.RSA.features[0]),e=[-1*t[0],-1*t[1]];map.projection.scale(1).translate([0,0]).rotate(e);var a=map.path.bounds(map.RSA),i=.95/Math.max((a[1][0]-a[0][0])/map.width,(a[1][1]-a[0][1])/map.height),r=[(map.width-i*(a[1][0]+a[0][0]))/2,(map.height-i*(a[1][1]+a[0][1]))/2];map.projection.scale(i).translate(r)},this.animate=function(t){var e=2.5,a=document.querySelector(t),i=a.getTotalLength();a.style.strokeDasharray=i+" "+i,a.style.strokeDashoffset=i,a.style.transition=a.style.WebkitTransition="none",a.getBoundingClientRect(),a.style.transition=a.style.WebkitTransition="stroke-dashoffset "+e+"s ease",a.style.strokeDashoffset="0"},this.arrangeLabels=function(){for(var t=this,e=1;e>0;)e=0,t.layer2.selectAll(".BOCES-name").each(function(){var a=this,i=this.getBoundingClientRect();t.layer2.selectAll(".BOCES-name").each(function(){if(this!=a){var t=this.getBoundingClientRect();if(2*Math.abs(i.left-t.left)<i.width+t.width&&2*Math.abs(i.top-t.top)<i.height+t.height){var r=.01*(Math.max(0,i.right-t.left)+Math.min(0,i.left-t.right)),n=.08*(Math.max(0,i.bottom-t.top)+Math.min(0,i.top-t.bottom)),s=d3.transform(d3.select(this).attr("transform")),o=d3.transform(d3.select(a).attr("transform"));e+=Math.abs(r)+Math.abs(n),o.translate=[o.translate[0]+r,o.translate[1]+n],s.translate=[s.translate[0]-r,s.translate[1]-n],d3.select(this).attr("transform","translate("+s.translate+")"),d3.select(a).attr("transform","translate("+o.translate+")"),i=this.getBoundingClientRect()}}})})},this.BOCES_OnClick=function(t){console.log(t),$("#80731").click()},this.district_OnClick=function(t){console.log(t)}}var map=new ColoradoMap("map");map.initMap();